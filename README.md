# Python Molecular Editor

Pythonで構築された、シンプルで直感的な分子構造エディターです。2Dでの分子描画と、リアルタイムでの3D構造可視化をサポートします。

  
*(スクリーンショットは実際のアプリケーションの動作イメージです)*

## 概要

このアプリケーションは、化学者や学生が分子構造を容易に描き、その3次元的な形状を視覚的に確認するためのツールです。PyQt6によるモダンなGUI、RDKitによる強力な化学計算、PyVistaによる高性能な3Dレンダリングを組み合わせています。

## 主な機能

  * **直感的な2D描画**:
      * マウスのクリック＆ドラッグで原子や結合を簡単に追加・編集。
      * 原子（C, N, O, Hなど）や結合（単結合、二重結合、三重結合）のツールバーからの選択。
      * 周期表から他の元素を選択可能。
      * 描画した分子の2D構造最適化（クリーンアップ）。
  * **高品質な3D可視化**:
      * 描画した2D構造をワンクリックで3D構造に変換。
      * RDKitによる力場計算（MMFF94）に基づいた安定な3D構造を生成。
      * PyVistaによるスムーズな3Dモデルの回転、ズーム、パン操作。
  * **多彩なファイル操作**:
      * 2D構造をMOL形式で保存。
      * 3D構造をXYZ形式で保存。
      * MOL/SDFファイルの読み込み。
      * 編集中の状態を保存・読み込みできるプロジェクトファイル機能（`.pmeraw`）。
  * **基本的な編集機能**:
      * 元に戻す/やり直す（Undo/Redo）。
      * 選択、全選択、削除。

## 依存ライブラリ

このアプリケーションを実行するには、以下のライブラリが必要です。

  * **PyQt6**: GUIフレームワーク
  * **RDKit**: 化学情報学ツールキット
  * **PyVista**: 3D可視化ライブラリ
  * **pyvistaqt**: PyVistaをPyQtに統合するためのライブラリ
  * **NumPy**: 数値計算ライブラリ

これらのライブラリは、pipやcondaを通じてインストールできます。

```bash
pip install PyQt6 rdkit numpy pyvista pyvistaqt
```

*注意: `rdkit`のインストールはcondaを使用することが推奨されています。*

```bash
conda install -c conda-forge rdkit
```

## 実行方法

1.  上記ライブラリをインストールします。
2.  ターミナル（コマンドプロンプト）で以下のコマンドを実行します。

<!-- end list -->

```bash
python pymoledit.py
```

## 技術的な仕組み

  * **GUIと2D描画 (PyQt6)**:
    アプリケーションの骨格と2D描画キャンバスはPyQt6の`Graphics View Framework`で構築されています。`QGraphicsScene`上にカスタムの`AtomItem`（原子）と`BondItem`（結合）を配置し、ユーザーのマウスイベントに応じて構造を対話的に構築します。

  * **化学計算 (RDKit)**:
    2Dで描画された構造情報からMOLブロックを生成し、RDKitに入力します。RDKitは3D座標の生成 (`AllChem.EmbedMolecule`) と構造最適化 (`AllChem.MMFFOptimizeMolecule`) を担当します。計算はバックグラウンドスレッド (`QThread`) で実行され、GUIの応答性を維持しています。

  * **3D可視化 (PyVista)**:
    RDKitによって計算された3D座標と原子種に基づき、PyVistaが3Dモデルを生成します。原子は`pv.Sphere`（球）、結合は`pv.Cylinder`（円柱）として描画され、`QtInteractor`ウィジェットを通じてウィンドウ内に表示されます。

## ライセンス

LICENSEファイルをご確認ください。
